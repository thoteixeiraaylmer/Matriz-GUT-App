
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Matriz GUT - Mini App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f8f9fa;
    }
    h2 {
      text-align: center;
    }
    form {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      max-width: 800px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, select, button {
      margin: 8px 0;
      padding: 8px;
      width: 100%;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .problema {
      margin-top: 20px;
      padding: 15px;
      background: #f1f1f1;
      border-radius: 6px;
    }
    .linha {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .linha > div {
      flex: 1;
    }
    .resultado {
      font-weight: bold;
      color: #2d6a4f;
    }
    .botoes {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>Matriz GUT</h2>
  <form id="gutForm">
    <input type="text" name="nome" placeholder="Seu nome" required>
    <input type="email" name="email" placeholder="Seu e-mail" required>

    <div id="problemas"></div>

    <div class="botoes">
      <button type="button" onclick="adicionarProblema()">Adicionar Problema</button>
      <button type="submit">Enviar</button>
    </div>
  </form>

  <script>
    function adicionarProblema() {
      const problemasDiv = document.getElementById('problemas');

      const problemaHTML = document.createElement('div');
      problemaHTML.classList.add('problema');

      const template = `
        <input type="text" name="problema" placeholder="Descreva o problema" required>
        <div class="linha">
          <div>
            Gravidade:
            <select name="gravidade">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>
          <div>
            Urgência:
            <select name="urgencia">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>
          <div>
            Tendência:
            <select name="tendencia">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>
          <div>
            Resultado:
            <span class="resultado">0</span>
          </div>
        </div>
      `;

      problemaHTML.innerHTML = template;
      problemasDiv.appendChild(problemaHTML);

      problemaHTML.querySelectorAll('select').forEach(select => {
        select.addEventListener('change', () => calcularResultado(problemaHTML));
      });
    }

    function calcularResultado(divProblema) {
      const g = parseInt(divProblema.querySelector('select[name="gravidade"]').value);
      const u = parseInt(divProblema.querySelector('select[name="urgencia"]').value);
      const t = parseInt(divProblema.querySelector('select[name="tendencia"]').value);
      const resultado = g * u * t;
      divProblema.querySelector('.resultado').innerText = resultado;
    }

    document.getElementById('gutForm').addEventListener('submit', function(event) {
      event.preventDefault();
      
      const formData = new FormData(this);
      const problemas = [];
      document.querySelectorAll('.problema').forEach(div => {
        problemas.push({
          problema: div.querySelector('input[name="problema"]').value,
          gravidade: div.querySelector('select[name="gravidade"]').value,
          urgencia: div.querySelector('select[name="urgencia"]').value,
          tendencia: div.querySelector('select[name="tendencia"]').value,
          resultado: div.querySelector('.resultado').innerText
        });
      });

      const dados = {
        nome: formData.get('nome'),
        email: formData.get('email'),
        problemas: problemas
      };

      fetch('https://script.google.com/macros/s/AKfycbyoV-7hJPPFQ1zvQ1Ydv6BjJWQ8OLrcxmYq7xKLRTRuNX2hDVWXJVP28zL_2sdv4cu5hg/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(dados)
      }).then(() => {
        alert('Formulário enviado com sucesso!');
        document.getElementById('gutForm').reset();
        document.getElementById('problemas').innerHTML = '';
      }).catch(error => {
        console.error('Erro ao enviar:', error);
        alert('Erro no envio, tente novamente.');
      });
    });
  </script>
</body>
</html>
